"use strict";var w=Object.create;var l=Object.defineProperty;var v=Object.getOwnPropertyDescriptor;var b=Object.getOwnPropertyNames,d=Object.getOwnPropertySymbols,x=Object.getPrototypeOf,u=Object.prototype.hasOwnProperty,z=Object.prototype.propertyIsEnumerable;var P=(o,e,r)=>e in o?l(o,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[e]=r,n=(o,e)=>{for(var r in e||(e={}))u.call(e,r)&&P(o,r,e[r]);if(d)for(var r of d(e))z.call(e,r)&&P(o,r,e[r]);return o};var S=(o,e)=>{for(var r in e)l(o,r,{get:e[r],enumerable:!0})},j=(o,e,r,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let t of b(e))!u.call(o,t)&&t!==r&&l(o,t,{get:()=>e[t],enumerable:!(s=v(e,t))||s.enumerable});return o};var g=(o,e,r)=>(r=o!=null?w(x(o)):{},j(e||!o||!o.__esModule?l(r,"default",{value:o,enumerable:!0}):r,o)),_=o=>j(l({},"__esModule",{value:!0}),o);var W={};S(W,{Wappalyzer:()=>m,default:()=>O});module.exports=_(W);var p=g(require("fs")),c=g(require("path")),y=g(require("wappalyzer-core")),f=require("undici"),C=g(require("os"));var m=class{constructor(e={}){this.options=e;this.loaded=!1;this.cache_path=c.default.resolve(c.default.join(C.default.homedir(),".simple-wappalyzer"));this.repository="enthec/webappanalyzer";e.path&&(this.cache_path=e.path),e.repository&&(this.repository=e.repository),this.files={categories:c.default.resolve(c.default.join(this.cache_path,"categories.json")),technologies:c.default.resolve(c.default.join(this.cache_path,"technologies.json"))}}async prepare(e){var r,s;try{if(this.loaded&&!e)return Promise.resolve(this);p.default.existsSync(this.cache_path)||p.default.mkdirSync(this.cache_path);let t={technologies:{},categories:{}};for(let[h,a]of Object.entries(this.files))if(p.default.existsSync(a)&&!e){let i=p.default.readFileSync(a,{flag:"r"});Object.assign(t,{[h]:JSON.parse(i.toString())})}else await this.fetch(h).then(i=>{Object.assign(t,{[h]:i})}).catch(Promise.reject);return y.default.setCategories(n(n({},t.categories),(r=this.options)==null?void 0:r.custom_categories)),y.default.setTechnologies(n(n({},t.technologies),(s=this.options)==null?void 0:s.custom_technologies)),this.loaded=!0,Promise.resolve(this)}catch(t){return this.loaded=!1,Promise.reject(t)}}async resolve(e,r=!1){return await this.prepare(r),y.default.resolve(y.default.analyze(e))}async fetch(e){if(e=="categories"){let r=await(0,f.fetch)(`https://raw.githubusercontent.com/${this.repository}/master/src/categories.json`);if(!r.ok||!r.body)return Promise.reject(new Error("Empty body"));let s=await r.json();return p.default.writeFileSync(this.files[e],JSON.stringify(s)),Promise.resolve(s)}else if(e=="technologies"){let s=Array.from({length:27},(a,i)=>i?String.fromCharCode(i+96):"_").reduce((a,i)=>(a.push((0,f.fetch)(`https://raw.githubusercontent.com/${this.repository}/master/src/technologies/${i}.json`).then(T=>T.json())),a),new Array),h=(await Promise.all(s)).reduce((a,i)=>n(n({},a),i),{});return p.default.writeFileSync(this.files[e],JSON.stringify(h)),Promise.resolve(h)}return Promise.reject(new Error("Invalid name"))}},O=m;0&&(module.exports={Wappalyzer});
