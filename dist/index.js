"use strict";var w=Object.create;var h=Object.defineProperty;var T=Object.getOwnPropertyDescriptor;var C=Object.getOwnPropertyNames,u=Object.getOwnPropertySymbols,z=Object.getPrototypeOf,j=Object.prototype.hasOwnProperty,S=Object.prototype.propertyIsEnumerable;var f=(o,e,t)=>e in o?h(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t,p=(o,e)=>{for(var t in e||(e={}))j.call(e,t)&&f(o,t,e[t]);if(u)for(var t of u(e))S.call(e,t)&&f(o,t,e[t]);return o};var _=(o,e)=>{for(var t in e)h(o,t,{get:e[t],enumerable:!0})},P=(o,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of C(e))!j.call(o,s)&&s!==t&&h(o,s,{get:()=>e[s],enumerable:!(r=T(e,s))||r.enumerable});return o};var m=(o,e,t)=>(t=o!=null?w(z(o)):{},P(e||!o||!o.__esModule?h(t,"default",{value:o,enumerable:!0}):t,o)),O=o=>P(h({},"__esModule",{value:!0}),o);var $={};_($,{Wappalyzer:()=>d,default:()=>N});module.exports=O($);var n=m(require("fs")),c=m(require("path")),y=m(require("wappalyzer-core")),g=require("undici"),v=m(require("os"));var b="@mojolabs-id/simple-wappalyzer";var d=class{constructor(e={}){this.options=e;this.loaded=!1;this.cache_path=c.default.resolve(c.default.join(v.default.homedir(),".cache",b));this.repository="enthec/webappanalyzer";e.path&&(this.cache_path=e.path),e.repository&&(this.repository=e.repository),this.files={categories:c.default.resolve(c.default.join(this.cache_path,"categories.json")),technologies:c.default.resolve(c.default.join(this.cache_path,"technologies.json"))}}async prepare(e){var t,r;try{if(this.loaded&&!e)return Promise.resolve(this);n.default.existsSync(this.cache_path)||n.default.mkdirSync(this.cache_path,{recursive:!0});let s={technologies:{},categories:{}};for(let[l,a]of Object.entries(this.files))if(n.default.existsSync(a)&&!e){let i=n.default.readFileSync(a,{flag:"r"});Object.assign(s,{[l]:JSON.parse(i.toString())})}else await this.fetch(l).then(i=>{Object.assign(s,{[l]:i})}).catch(Promise.reject);return y.default.setCategories(p(p({},s.categories),(t=this.options)==null?void 0:t.custom_categories)),y.default.setTechnologies(p(p({},s.technologies),(r=this.options)==null?void 0:r.custom_technologies)),this.loaded=!0,Promise.resolve(this)}catch(s){return this.loaded=!1,Promise.reject(s)}}async resolve(e,t=!1){return await this.prepare(t),y.default.resolve(y.default.analyze(e))}async fetch(e){if(e=="categories"){let t=await(0,g.fetch)(`https://raw.githubusercontent.com/${this.repository}/master/src/categories.json`);if(!t.ok||!t.body)return Promise.reject(new Error("Empty body"));let r=await t.json();return n.default.writeFileSync(this.files[e],JSON.stringify(r)),Promise.resolve(r)}else if(e=="technologies"){let r=Array.from({length:27},(a,i)=>i?String.fromCharCode(i+96):"_").reduce((a,i)=>(a.push((0,g.fetch)(`https://raw.githubusercontent.com/${this.repository}/master/src/technologies/${i}.json`).then(x=>x.json())),a),new Array),l=(await Promise.all(r)).reduce((a,i)=>p(p({},a),i),{});return n.default.writeFileSync(this.files[e],JSON.stringify(l)),Promise.resolve(l)}return Promise.reject(new Error("Invalid name"))}},N=d;0&&(module.exports={Wappalyzer});
